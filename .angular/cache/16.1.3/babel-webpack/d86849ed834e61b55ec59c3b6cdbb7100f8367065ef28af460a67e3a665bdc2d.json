{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"./role.service\";\nexport class SessionService {\n  constructor(roleService) {\n    this.TOKEN_KEY = 'token';\n    this.TOKEN_BY_DEFAULT = 'no_token';\n    this.roleService = roleService;\n  }\n  setUser(user) {\n    this.user = user;\n  }\n  getUser() {\n    return this.user;\n  }\n  isCurrentUserAuthorized() {\n    console.log('method isCurrentUserAuthorized, result ' + this.user);\n    if (this.user) return true;\n    return false;\n  }\n  isCurrentUserAdmin() {\n    console.log('method isCurrentUserAdmin');\n    if (!this.isCurrentUserAuthorized()) return false;\n    console.log('userRole = ' + this.user.userRole + ', roleService.adminRole = ' + this.roleService.adminRole);\n    return this.user.userRole == this.roleService.adminRole;\n  }\n  isCurrentUserMember() {\n    console.log('method isCurrentUserMember');\n    if (!this.isCurrentUserAuthorized()) return false;\n    console.log('userRole = ' + this.user.userRole + ', roleService.memberRole = ' + this.roleService.memberRole);\n    return this.user.userRole == this.roleService.memberRole;\n  }\n  resetUser() {\n    this.user = null;\n  }\n  ping() {\n    console.log('sessionStorage token=' + sessionStorage.getItem(this.TOKEN_KEY));\n    console.log('localStorage token=' + localStorage.getItem(this.TOKEN_KEY));\n  }\n  saveTokenToLocalStorage(token) {\n    localStorage.setItem(this.TOKEN_KEY, token);\n    console.log('method saveTokenToLocalStorage');\n    this.ping();\n  }\n  saveTokenToSessionStorage(token) {\n    sessionStorage.setItem(this.TOKEN_KEY, token);\n    console.log('method saveTokenToSessionStorage');\n    this.ping();\n  }\n  updateTokenWhereItWasSet(token) {\n    console.log('method updateTokenWhereItWasSet');\n    this.ping();\n    if (this.getTokenFromSessionStorage() != this.TOKEN_BY_DEFAULT) this.saveTokenToSessionStorage(token);\n    if (this.getTokenFromLocalStorage() != this.TOKEN_BY_DEFAULT) this.saveTokenToLocalStorage(token);\n    this.ping();\n  }\n  getTokenFromLocalStorage() {\n    console.log('method getTokenFromLocalStorage');\n    this.ping();\n    let token = localStorage.getItem(this.TOKEN_KEY);\n    return token ? token : this.TOKEN_BY_DEFAULT;\n  }\n  getTokenFromSessionStorage() {\n    console.log('method getTokenFromSessionStorage');\n    this.ping();\n    let token = sessionStorage.getItem(this.TOKEN_KEY);\n    return token ? token : this.TOKEN_BY_DEFAULT;\n  }\n  getToken() {\n    console.log('method getToken');\n    this.ping();\n    let token = this.getTokenFromSessionStorage();\n    if (token && token != this.TOKEN_BY_DEFAULT) {\n      console.log('token: ' + token);\n      return token;\n    }\n    token = this.getTokenFromLocalStorage();\n    if (token && token != this.TOKEN_BY_DEFAULT) {\n      this.saveTokenToSessionStorage(token);\n      console.log('token: ' + token);\n      return token;\n    }\n    console.log('token: ' + token);\n    return this.TOKEN_BY_DEFAULT;\n  }\n  removeTokenFromLocalStorage() {\n    console.log('method removeTokenFromLocalStorage');\n    this.ping();\n    localStorage.removeItem(this.TOKEN_KEY);\n    this.ping();\n  }\n  removeTokenFromSessionStorage() {\n    console.log('method removeTokenFromSessionStorage');\n    this.ping();\n    sessionStorage.removeItem(this.TOKEN_KEY);\n    this.ping();\n  }\n  removeTokenFromEverywhere() {\n    console.log('method removeTokenFromEverywhere');\n    this.removeTokenFromSessionStorage();\n    this.removeTokenFromLocalStorage();\n  }\n}\nSessionService.ɵfac = function SessionService_Factory(t) {\n  return new (t || SessionService)(i0.ɵɵinject(i1.RoleService));\n};\nSessionService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: SessionService,\n  factory: SessionService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"names":["SessionService","constructor","roleService","TOKEN_KEY","TOKEN_BY_DEFAULT","setUser","user","getUser","isCurrentUserAuthorized","console","log","isCurrentUserAdmin","userRole","adminRole","isCurrentUserMember","memberRole","resetUser","ping","sessionStorage","getItem","localStorage","saveTokenToLocalStorage","token","setItem","saveTokenToSessionStorage","updateTokenWhereItWasSet","getTokenFromSessionStorage","getTokenFromLocalStorage","getToken","removeTokenFromLocalStorage","removeItem","removeTokenFromSessionStorage","removeTokenFromEverywhere","i0","ɵɵinject","i1","RoleService","factory","ɵfac","providedIn"],"sources":["C:\\Важное\\6 семестр =)\\Практыка\\Проект\\questionnaire\\angular-questionnaire\\src\\app\\service\\session.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport {User} from \"../entity/User\";\nimport {RoleService} from \"./role.service\";\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SessionService {\n  private TOKEN_KEY = 'token';\n  private TOKEN_BY_DEFAULT = 'no_token';\n\n  private user: User;\n\n  private roleService: RoleService;\n\n  constructor(roleService: RoleService) {\n    this.roleService = roleService;\n  }\n\n  setUser(user: User) {\n    this.user = user;\n  }\n\n  getUser() {\n    return this.user;\n  }\n\n  isCurrentUserAuthorized(): boolean {\n    console.log('method isCurrentUserAuthorized, result ' + this.user);\n    if (this.user)\n      return true;\n    return false;\n  }\n\n  isCurrentUserAdmin(): boolean {\n    console.log('method isCurrentUserAdmin');\n    if (!this.isCurrentUserAuthorized())\n      return false;\n    console.log('userRole = ' + this.user.userRole + ', roleService.adminRole = ' + this.roleService.adminRole);\n    return this.user.userRole == this.roleService.adminRole;\n  }\n\n  isCurrentUserMember(): boolean {\n    console.log('method isCurrentUserMember');\n    if (!this.isCurrentUserAuthorized())\n      return false;\n    console.log('userRole = ' + this.user.userRole + ', roleService.memberRole = ' + this.roleService.memberRole);\n    return this.user.userRole == this.roleService.memberRole;\n  }\n\n  resetUser() {\n    this.user = null;\n  }\n\n  ping() {\n    console.log('sessionStorage token=' + sessionStorage.getItem(this.TOKEN_KEY));\n    console.log('localStorage token=' + localStorage.getItem(this.TOKEN_KEY));\n  }\n\n  saveTokenToLocalStorage(token: string){\n    localStorage.setItem(this.TOKEN_KEY, token);\n\n    console.log('method saveTokenToLocalStorage');\n    this.ping();\n  }\n\n  saveTokenToSessionStorage(token: string) {\n    sessionStorage.setItem(this.TOKEN_KEY, token);\n\n    console.log('method saveTokenToSessionStorage');\n    this.ping();\n  }\n\n  updateTokenWhereItWasSet(token: string) {\n    console.log('method updateTokenWhereItWasSet');\n    this.ping();\n\n    if (this.getTokenFromSessionStorage() != this.TOKEN_BY_DEFAULT)\n      this.saveTokenToSessionStorage(token);\n    if (this.getTokenFromLocalStorage() != this.TOKEN_BY_DEFAULT)\n      this.saveTokenToLocalStorage(token);\n\n    this.ping();\n  }\n\n  getTokenFromLocalStorage() {\n    console.log('method getTokenFromLocalStorage');\n    this.ping();\n\n    let token = localStorage.getItem(this.TOKEN_KEY);\n    return token ? token : this.TOKEN_BY_DEFAULT;\n  }\n\n  getTokenFromSessionStorage() {\n    console.log('method getTokenFromSessionStorage');\n    this.ping();\n\n    let token = sessionStorage.getItem(this.TOKEN_KEY);\n    return token ? token : this.TOKEN_BY_DEFAULT;\n  }\n\n  getToken() {\n    console.log('method getToken');\n    this.ping();\n\n    let token = this.getTokenFromSessionStorage();\n    if (token && token != this.TOKEN_BY_DEFAULT) {\n      console.log('token: ' + token);\n      return token;\n    }\n    token = this.getTokenFromLocalStorage();\n    if (token && token != this.TOKEN_BY_DEFAULT) {\n      this.saveTokenToSessionStorage(token);\n      console.log('token: ' + token);\n      return token;\n    }\n    console.log('token: ' + token);\n    return this.TOKEN_BY_DEFAULT;\n  }\n\n  removeTokenFromLocalStorage(){\n    console.log('method removeTokenFromLocalStorage');\n    this.ping();\n\n    localStorage.removeItem(this.TOKEN_KEY);\n\n    this.ping();\n  }\n\n  removeTokenFromSessionStorage(){\n    console.log('method removeTokenFromSessionStorage');\n    this.ping();\n\n    sessionStorage.removeItem(this.TOKEN_KEY);\n\n    this.ping();\n  }\n\n  removeTokenFromEverywhere(){\n    console.log('method removeTokenFromEverywhere');\n    this.removeTokenFromSessionStorage();\n    this.removeTokenFromLocalStorage();\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}