{"ast":null,"code":"import { catchError, tap, throwError } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./error.service\";\nimport * as i3 from \"./session.service\";\nexport class UserService {\n  constructor(http, errorService, sessionService) {\n    this.http = http;\n    this.errorService = errorService;\n    this.sessionService = sessionService;\n  }\n  getAll() {\n    let token = this.sessionService.getToken();\n    return this.http.post('http://localhost:8080/users', token).pipe(catchError(this.errorHandler.bind(this)));\n  }\n  getUserById(id) {\n    let token = this.sessionService.getToken();\n    let path = 'http://localhost:8080/users/' + id;\n    return this.http.post(path, token).pipe(catchError(this.errorHandler.bind(this)));\n  }\n  register(user, password) {\n    const userWithPassword = {\n      user: user,\n      password: password\n    };\n    return this.http.post('http://localhost:8080/register', userWithPassword).pipe(catchError(this.errorHandler.bind(this)), tap(result => {\n      if (result.success) {\n        this.updateTokenInSession(result.token);\n      }\n    }));\n  }\n  login(email, password, rememberMe) {\n    const loginData = {\n      email: email,\n      password: password\n    };\n    return this.http.post('http://localhost:8080/login', loginData).pipe(catchError(this.errorHandler.bind(this)), tap(result => {\n      if (result.success) {\n        this.updateTokenWithRememberMeFlag(result.token, rememberMe);\n      }\n    }));\n  }\n  changePassword(oldPassword, newPassword) {\n    let token = this.sessionService.getToken();\n    const tokenWithChangePasswordData = {\n      token: token,\n      oldPassword: oldPassword,\n      newPassword: newPassword\n    };\n    return this.http.post('http://localhost:8080/change_password', tokenWithChangePasswordData).pipe(catchError(this.errorHandler.bind(this)), tap(result => {\n      if (result.success) {\n        this.updateTokenWhereItWasSet(result.token);\n      }\n    }));\n  }\n  saveUser(user) {\n    let token = this.sessionService.getToken();\n    const tokenWithUser = {\n      token: token,\n      user: user\n    };\n    return this.http.post('http://localhost:8080/save_user', tokenWithUser).pipe(catchError(this.errorHandler.bind(this)), tap(result => {\n      if (result.success) {\n        this.updateTokenWhereItWasSet(result.token);\n      }\n    }));\n  }\n  updateTokenWithRememberMeFlag(token, rememberMe) {\n    if (rememberMe) this.updateTokenGlobally(token);else this.updateTokenGlobally(token);\n  }\n  updateTokenInSession(token) {\n    this.sessionService.saveTokenToSessionStorage(token);\n  }\n  updateTokenGlobally(token) {\n    this.sessionService.saveTokenToSessionStorage(token);\n    this.sessionService.saveTokenToLocalStorage(token);\n  }\n  updateTokenWhereItWasSet(token) {\n    this.sessionService.updateTokenWhereItWasSet(token);\n  }\n  errorHandler(error) {\n    this.errorService.handle(error.message);\n    return throwError(() => error.message);\n  }\n}\nUserService.ɵfac = function UserService_Factory(t) {\n  return new (t || UserService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.ErrorService), i0.ɵɵinject(i3.SessionService));\n};\nUserService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: UserService,\n  factory: UserService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"names":["catchError","tap","throwError","UserService","constructor","http","errorService","sessionService","getAll","token","getToken","post","pipe","errorHandler","bind","getUserById","id","path","register","user","password","userWithPassword","result","success","updateTokenInSession","login","email","rememberMe","loginData","updateTokenWithRememberMeFlag","changePassword","oldPassword","newPassword","tokenWithChangePasswordData","updateTokenWhereItWasSet","saveUser","tokenWithUser","updateTokenGlobally","saveTokenToSessionStorage","saveTokenToLocalStorage","error","handle","message","i0","ɵɵinject","i1","HttpClient","i2","ErrorService","i3","SessionService","factory","ɵfac","providedIn"],"sources":["C:\\Важное\\6 семестр =)\\Практыка\\Проект\\questionnaire\\angular-questionnaire\\src\\app\\service\\user.service.ts"],"sourcesContent":["import {Injectable} from \"@angular/core\";\r\nimport {HttpClient, HttpErrorResponse} from \"@angular/common/http\";\r\nimport {catchError, Observable, tap, throwError} from \"rxjs\";\r\nimport {User} from \"../entity/User\";\r\nimport {ErrorService} from \"./error.service\";\r\nimport {AuthorizeResult} from \"../additional/AuthorizeResult\";\r\nimport {SessionService} from \"./session.service\";\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UserService {\r\n  private http: HttpClient;\r\n  private errorService: ErrorService;\r\n  private sessionService: SessionService;\r\n\r\n  constructor(http: HttpClient,\r\n              errorService: ErrorService,\r\n              sessionService: SessionService) {\r\n    this.http = http;\r\n    this.errorService = errorService;\r\n    this.sessionService = sessionService;\r\n  }\r\n\r\n  getAll() : Observable<User[]> {\r\n    let token = this.sessionService.getToken();\r\n    return this.http.post<User[]>('http://localhost:8080/users', token)\r\n      .pipe(\r\n        catchError(this.errorHandler.bind(this)),\r\n      )\r\n  }\r\n\r\n  getUserById(id: bigint) : Observable<User> {\r\n    let token = this.sessionService.getToken();\r\n    let path = 'http://localhost:8080/users/' + id;\r\n    return this.http.post<User>(path, token)\r\n      .pipe(\r\n        catchError(this.errorHandler.bind(this)),\r\n      )\r\n  }\r\n\r\n  register(user: User, password: string): Observable<AuthorizeResult> {\r\n    const userWithPassword = {user: user, password: password};\r\n\r\n    return this.http.post<AuthorizeResult>('http://localhost:8080/register', userWithPassword)\r\n      .pipe(\r\n        catchError(this.errorHandler.bind(this)),\r\n        tap(result => {\r\n          if (result.success) {\r\n            this.updateTokenInSession(result.token);\r\n          }\r\n        })\r\n      );\r\n  }\r\n\r\n  login(email: string, password: string, rememberMe: boolean): Observable<AuthorizeResult> {\r\n    const loginData = {email: email, password: password};\r\n\r\n    return this.http.post<AuthorizeResult>('http://localhost:8080/login', loginData)\r\n      .pipe(\r\n        catchError(this.errorHandler.bind(this)),\r\n        tap(result => {\r\n          if (result.success) {\r\n            this.updateTokenWithRememberMeFlag(result.token, rememberMe);\r\n          }\r\n        })\r\n      );\r\n  }\r\n\r\n  changePassword(oldPassword: string, newPassword: string): Observable<AuthorizeResult> {\r\n    let token = this.sessionService.getToken();\r\n    const tokenWithChangePasswordData = {\r\n      token: token, oldPassword: oldPassword, newPassword: newPassword\r\n    };\r\n\r\n    return this.http.post<AuthorizeResult>('http://localhost:8080/change_password', tokenWithChangePasswordData)\r\n      .pipe(\r\n        catchError(this.errorHandler.bind(this)),\r\n        tap(result => {\r\n          if (result.success) {\r\n            this.updateTokenWhereItWasSet(result.token);\r\n          }\r\n        })\r\n      );\r\n  }\r\n\r\n  saveUser(user: User): Observable<AuthorizeResult> {\r\n    let token = this.sessionService.getToken();\r\n    const tokenWithUser = {\r\n      token: token, user: user\r\n    };\r\n\r\n    return this.http.post<AuthorizeResult>('http://localhost:8080/save_user', tokenWithUser)\r\n      .pipe(\r\n        catchError(this.errorHandler.bind(this)),\r\n        tap(result => {\r\n          if (result.success) {\r\n            this.updateTokenWhereItWasSet(result.token);\r\n          }\r\n        })\r\n      );\r\n  }\r\n\r\n  private updateTokenWithRememberMeFlag(token: string, rememberMe: boolean) {\r\n    if (rememberMe)\r\n      this.updateTokenGlobally(token);\r\n    else\r\n      this.updateTokenGlobally(token);\r\n  }\r\n\r\n  private updateTokenInSession(token: string) {\r\n    this.sessionService.saveTokenToSessionStorage(token);\r\n  }\r\n\r\n  private updateTokenGlobally(token: string) {\r\n    this.sessionService.saveTokenToSessionStorage(token);\r\n    this.sessionService.saveTokenToLocalStorage(token);\r\n  }\r\n\r\n  private updateTokenWhereItWasSet(token: string) {\r\n    this.sessionService.updateTokenWhereItWasSet(token);\r\n  }\r\n\r\n  private errorHandler(error: HttpErrorResponse) {\r\n    this.errorService.handle(error.message);\r\n    return throwError(() => error.message);\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}